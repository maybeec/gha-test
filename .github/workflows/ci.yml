name: CI
on:
  workflow_dispatch:
  push:
  pull_request:
  
jobs:
  ci:
    runs-on: ubuntu-latest
    steps:
      - run: echo "CI"
  
  release:
    needs: ci
    runs-on: ubuntu-latest
    if: ${{ startsWith(github.repository, 'maybeec/') && github.ref == 'refs/heads/main' }}
    environment:
      name: production
    outputs:
      released: ${{ steps.release-status.released }}
    steps:
      - id: release
        continue-on-error: true
        run: |
          # set output to have an indicator whether the deployment was rejected or the script failed
          echo "::set-output name=ran-release-script::true"
          exit 1 && echo "Release"
      - name: Skipped Release
        if: failure() && steps.release.outputs.ran-release-script == true
        id: release-status
        run: echo "::set-output name=released::"${{ steps.release.outcome == 'success' && steps.release.outputs.ran-release-script == true }}
  
  after-release:
    needs: release
    uses: maybeec/gha-test/.github/workflows/post-release-workflow.yml@main
    with:
      SKIP: ${{ needs.ci.outputs.released == false }}
